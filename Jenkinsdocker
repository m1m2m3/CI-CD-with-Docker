node 
{
     def app
   stage('SCM checkout') 
             { 
               git 'https://github.com/m1m2m3/CI-CD-with-Docker.git'
	      }
    stage('Build image') 
    	 {
          app = docker.build("akshay/myimgg")
         }
    stage('Test image') 
         {
            app.inside 
	    {
            echo "Tests passed"
            }
         }
    stage('Push image') 
          {
	    withDockerRegistry(credentialsId: 'dockerhub1', url: 'https://hub.docker.com/')
	     {
               app.push("${env.BUILD_NUMBER}")
               app.push("latest")
             } 
                echo "Trying to Push Docker Build to DockerHub"
          }
}
